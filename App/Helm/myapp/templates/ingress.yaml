apiVersion: extensions/v1beta1
kind: Ingress
metadata:
    # namespace: {{ .Release.Namespace }}
    name: {{ .Chart.Name }}-{{ .Values.environment }}
    annotations:
        kubernetes.io/ingress.class: alb
        alb.ingress.kubernetes.io/scheme: internet-facing
        alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS": 443}]'
        alb.ingress.kubernetes.io/security-groups: {{ .Values.ingress.sg }}
        alb.ingress.kubernetes.io/healthcheck-path: {{ .Values.deployment.livenessProbe.httpGet.path }}
        alb.ingress.kubernetes.io/unhealthy-threshold-count: '2'
        alb.ingress.kubernetes.io/healthy-threshold-count: '5'
        alb.ingress.kubernetes.io/healthcheck-timeout-seconds: '5'
        alb.ingress.kubernetes.io/healthcheck-interval-seconds: '30'
        alb.ingress.kubernetes.io/healthcheck-protocol: HTTP
        alb.ingress.kubernetes.io/tags: Name=ALB-{{ .Values.env.name }}-{{ .Values.environment | upper }}-{{ .Release.Namespace }}, 
                                        project={{ .Values.env.name | upper }},
                                        Environment={{ .Values.environment | upper }},
                                        ManagedBy=helm-chart
        # alb.ingress.kubernetes.io/actions.redirect: >-
        #   {"Type": "redirect", "RedirectConfig": { "Protocol": "HTTPS",
        #   "StatusCode": "HTTP_301", "Port": "443"}}
        lb.ingress.kubernetes.io/success-codes:  "302"
spec:
    rules:
    # - http:
    #     paths:
    #       - backend:
    #           serviceName: redirect
    #           servicePort: use-annotation
    - host: {{ .Values.ingress.host }}
      http:
        paths: 
            - backend:
                serviceName: {{ .Chart.Name }}-{{ .Values.environment }}
                servicePort: {{ .Values.service.targetport }}
    # {{- if .Values.ingress.otherhost }}
    # - host: {{ .Values.ingress.host }}
    #   http:
    #       paths:
    #           - backend:
    #                 serviceName: {{ .Values.ingress.name }}
    #                 servicePort: 80
    # {{- end }}